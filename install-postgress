#!/usr/bin/env bash

sudo apt update
sudo apt install --yes postgresql postgresql-contrib
sudo systemctl start postgresql.service

# switch to postgres linux user (auto generated by installer)
sudo -i -u postgres
sudo -u postgres createuser --superuser allemps --replication --inherit -P
# password : emps
sudo -u allemps createdb allemps
sudo adduser allemps

sudo -i -u allemps

echo "
CREATE TABLE test(
  ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL
);
"| psql


# creatteing replication user 

echo "
CREATE USER emps_replication REPLICATION LOGIN ENCRYPTED PASSWORD 'emps_password';
" | psql

echo "
wal_level = logical
wal_log_hints = on
max_wal_senders = 8
hot_standby = on ">>  /etc/postgresql/12/main/postgresql.conf


#  /etc/postgresql/12/main/postgresql.conf

listen_addresses = '*'
port = 5433	
